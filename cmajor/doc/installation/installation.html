<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Installation</title>
    <link rel="stylesheet" type="text/css" href="../style/library.css" />
</head>
<body>
    <h1>Installation</h1>

    <h2>
        1 Installation on Windows
    </h2>

    <h3>
        1.1 Cmajor installation
    </h3>

    <p>
        <a href="https://sourceforge.net/projects/cmajor/files/3.2.0/cmajor-3.2.0-win-x64-setup.exe">Download</a> the setup program and run it.
        You can specify installation directory that is by default <b>C:\cmajor</b>.
        Note: the compiler needs write access to installation directory and its subdirectories,
        so C:\Program Files\ is not a good place to install.
        The setup creates an environment variable CMAJOR_ROOT that points to the installation directory
        and adds the CMAJOR_ROOT\bin directory to PATH. The setup adds a shortcut to <em>CmajorDevEnv</em>
        (IDE) to the desktop.
    </p>

    <img src="image/Cmajor.png" />

    <h3>
        1.2 Llvm installation
    </h3>

    <p>
        <ul>
            <li>
                Download and install <a href="http://releases.llvm.org/download.html#7.0.0">LLVM 7.0</a> or newer
                <a href="http://releases.llvm.org/7.0.0/LLVM-7.0.0-win64.exe">pre-built binaries for Windows (64-bit)</a>.
            </li>
            <li>
                Add LLVM tools to System PATH so that Cmajor compiler can find them:
            </li>
        </ul>
    </p>

    <img src="image/LLVM.png" />

    <h3>
        1.3 Troubleshooting
    </h3>

    <h4>1.3.1 Error</h4>

    <p>
        The following error occurs in Cmajor IDE when LLVM tools are not found from System PATH environment variable:
    </p>

    <img src="image/llvm_tools_not_found.png" />

    <h4>1.3.2 Resolution</h4>

    <p>
        Add LLVM\bin directory to PATH:
    </p>

    <img src="image/adding_llvm_to_path.png" />

    <h3>
        1.4 Optional: Installing Cmajor Visual Studio extension
    </h3>

    <p>
        It's assumed that you have a working Visual Studio version installed.
    </p>

    <h4>
        1.4.1 Step 1: Installing Visual Studio extension
    </h4>

    <ul>
        <li>
            <p>
                Exit Visual Studio.
            </p>
        </li>

        <li>
            <p>
                Go to <strong>C:\cmajor\vs</strong> directory and double click the <strong>cmajor.vsix</strong> Visual Studio extension, or right-click it and select Open.
            </p>
        </li>

        <img src="image/cmajor_vsix.png" />

        <li>
            <p>
                VSIX installer opens. Click the Install button:
            </p>
        </li>

        <img src="image/vsix_installer.png" />

        <li>
            <p>
                Installation complete:
            </p>
        </li>

        <img src="image/vsix_installed.png" />
    </ul>

    <h4>
        1.4.2 Step 2: Installing Cmajor project system files
    </h4>

    <ul>
        <li>
            <p>
                Open command prompt to the <strong>C:\cmajor\vs</strong> directory for example by typing <strong>cmd</strong> to the folder line of the Windows Exporer and pressing enter:
            </p>
        </li>

        <img src="image/cmd.png" />

        <li>
            <p>
                Run <strong>CreateCmajorCps</strong>.
            </p>
        </li>

        <img src="image/cmajor_cps.png" />

        <li>
            <p>
                Cmajor project system installation is now complete.
            </p>
        </li>
    </ul>

    <h3>
        1.5 Tour of Cmajor Visual Studio extension
    </h3>

    <p>
        Here's a <a href="tour.html">tour</a> of features of the extension.
    </p>

    <h3>
        1.6 Uninstalling Cmajor Visual Studio extension
    </h3>

    <ul>
        <li>
            <p>
                Select <strong>Tools | Extensions and Updates...</strong> menu item in Visual Studio.
            </p>
        </li>

        <li>
            <p>
                Click the <strong>Uninstall</strong> button of the <strong>Cmajor Project Type VSIX</strong> item.
            </p>
        </li>

        <img src="image/extensions.png" />

        <li>
            <p>
                Exit Visual Studio and then click the Modify button.
            </p>
        </li>

        <img src="image/uninstalling.png" />

        <li>
            <p>
                Extension uninstalled:
            </p>
        </li>

        <img src="image/uninstalled.png" />

    </ul>

    <h2>
        2 Installation on Linux
    </h2>

    <p>
        The Cmajor tools need the following libraries to be installed:
    </p>

    <ul>
        <li><a href="https://zlib.net/">ZLib</a> (zlib1g-dev package)</li>
        <li><a href="http://www.sourceware.org/bzip2//">BZip2</a> (libbz2-dev package)</li>
        <li><a href="https://www.gnutls.org/">GnuTLS</a> (libgnutls28-dev package)</li>
        <li><a href="http://www.boost.org/">Boost</a> (libboost-all-dev package) (actually only <b>filesystem</b> and <b>iostreams</b> libraries need to be installed)</li>
        <li><a href="http://releases.llvm.org/download.html#7.0.0">Clang and LLVM version 7.0 or newer</a></li>
        <li>libtinfo-dev package also may be needed</li>
    </ul>

    <p>
        These libraries can be installed by using the package manager of your distro (for example <b>apt-get</b> on Ubuntu) or built and installed from sources.
    </p>

    <p>
        Sections 2.1, 2.2 and 2.3 describe alternative ways of installing Cmajor under Linux.
    </p>

    <h3>
        2.1 Installation on x86_64 Ubuntu Linux 18.04 using prebuilt binaries
    </h3>

    <ul>
        <li><a href="https://sourceforge.net/projects/cmajor/files/3.2.0/cmajor-3.2.0-ubuntu-18.04-x86_64-binaries.tar.bz2">Download</a> pre-built binaries for x86_64 Ubuntu 18.04.</li>
        <li>Extract the package to the directory of your choice here called <em>cmajor-3.2.0</em>.</li>
        <li>Create an environment variable named 'CMAJOR_ROOT' and set it to point to <em>/path/to/cmajor-3.2.0</em> directory. You need to add it to your shell script to make it permanent.</li>
        <li>Insert <em>/path/to/cmajor-3.2.0/<b>bin</b></em> directory to your PATH environment variable.</li>
        <li>Insert <em>/path/to/cmajor-3.2.0/<b>lib</b></em> directory to your LD_LIBRARY_PATH environment variable.</li>
    </ul>

    <h3>
        2.2 Installation from sources
    </h3>

    <ul>
        <li><a href="https://sourceforge.net/projects/cmajor/files/3.2.0/cmajor-3.2.0-src.tar.bz2">Download</a> Cmajor source code with unicode db.</li>
        <li>Extract the package to the directory of your choice here called <em>cmajor-3.2.0</em>.</li>
        <li>Create an environment variable named 'CMAJOR_ROOT' and set it to point to <em>/path/to/cmajor-3.2.0/cmajor</em> directory. You need to add it to your shell script to make it permanent.</li>
        <li>Change to <em>cmajor-3.2.0/cmajor</em> directory and run <b>make</b> from there.</li>
        <li>
            Install the binaries and libraries by running <b>sudo make install</b>. By default binaries are installed to <em>/usr/local/bin</em> and the libraries to <em>/usr/local/lib</em>.
            You can install to a different location by giving command <b>sudo make prefix=/where/to/install install</b> instead.
        </li>
        <li>Insert <em>/where/you/installed/<b>lib</b></em> directory to your LD_LIBRARY_PATH environment variable.</li>
        <li>Build Cmajor system libraries by giving command <b>make sys</b>.</li>
    </ul>

    <h3>
        2.3 Installation on x86_64 Ubuntu Linux 18.04 running on Windows Subsystem for Linux
    </h3>

    <ul>
        <li>
            If you don't have installed Windows Subsystem for Linux yet, <a href="https://docs.microsoft.com/fi-fi/windows/wsl/install-win10">here's</a> how to get it.
        </li>
        <li>
            Start command prompt, and start your distro. I use Ubuntu 18.04.
            <pre>
                C:\>ubuntu
                slaakko@ACER:~$
            </pre>
        </li>
        <li>
            First it's wise to update the system:
            <pre>
                sudo update
                sudo upgrade
            </pre>
        </li>
    </ul>

    <h4>
        2.3.1 Installing LLVM, LLD and Clang
    </h4>

    <ul>
        <li>
            Install LLVM prerequiesities gcc, g++, make and cmake:
            <pre>
                sudo apt-get install gcc g++ make cmake
            </pre>
        </li>
        <li>
            Retrieve and extract LLVM 7.0 sources (I used my home directory for this):
            <pre>
                # LLVM:
                wget http://releases.llvm.org/7.0.0/llvm-7.0.0.src.tar.xz
                tar --extract --xz -f llvm-7.0.0.src.tar.xz
                # Clang:
                wget http://releases.llvm.org/7.0.0/cfe-7.0.0.src.tar.xz
                tar --extract --xz -f cfe-7.0.0.src.tar.xz
                # move cfe-7.0.0.src directory under llvm-7.0.0.src/tools with name 'clang'
                mv cfe-7.0.0.src llvm-7.0.0.src/tools/clang
                # libcxx
                wget http://releases.llvm.org/7.0.0/libcxx-7.0.0.src.tar.xz
                tar --extract --xz -f libcxx-7.0.0.src.tar.xz
                # move libcxx-7.0.0.src directory under llvm-7.0.0.src/tools with name 'libcxx'
                mv libcxx-7.0.0.src llvm-7.0.0.src/tools/libxx
                # libcxxabi
                wget http://releases.llvm.org/7.0.0/libcxxabi-7.0.0.src.tar.xz
                tar --extract --xz -f libcxxabi-7.0.0.src.tar.xz
                # move libcxxabi-7.0.0.src directory under llvm-7.0.0.src/tools with name 'libcxxabi'
                mv libcxxabi-7.0.0.src llvm-7.0.0.src/tools/libcxxabi
                # lld:
                wget http://releases.llvm.org/7.0.0/lld-7.0.0.src.tar.xz
                tar --extract --xz -f lld-7.0.0.src.tar.xz
                # move lld-7.0.0.src directory under llvm-7.0.0.src/tools with name 'lld'
                mv lld-7.0.0.src llvm-7.0.0.src/tools/lld
            </pre>
        </li>
        <li>
            Move to llvm-7.0.0.src directory, create a build directory under it and change to the build directory:
            <pre>
                cd llvm-7.0.0.src
                mkdir build
                cd build
            </pre>
        </li>
        <li>
            I created make files for release configuration, for X86 target and enabling exception handling and RTTI:
            <pre>
                cmake -DCMAKE_BUILD_TYPE="Release" -DLLVM_TARGETS_TO_BUILD="X86" -DLLVM_ENABLE_EH=ON -DLLVM_ENABLE_RTTI=ON ..
            </pre>
        </li>
        <li>
            Build LLVM with tools (this may take quite long):
            <pre>
                cmake --build .
            </pre>
        </li>
        <li>
            Install it:
            <pre>
                sudo cmake --build . --target install
            </pre>
        </li>
    </ul>

    <h4>
        2.3.2 Installing Cmajor prerequisites
    </h4>

    <pre>
            sudo apt-get install zlib1g-dev libbz2-dev libgnutls28-dev libboost-all-dev libtinfo-dev
    </pre>    

    <h4>
        2.3.3 Installing Cmajor
    </h4>

    <ul>
        <li>
            Download and extract Cmajor sources:
            <pre>
                wget https://sourceforge.net/projects/cmajor/files/3.2.0/cmajor-3.2.0-src.tar.bz2
                tar xjf cmajor-3.2.0-src.tar.bz2
            </pre>
        </li>
        <li>
            Set CMAJOR_ROOT environment variable to point to cmajor-3.2.0/cmajor directory.
            It must be inserted to .bashrc to make it permanent.
            <pre>
                export CMAJOR_ROOT=~/cmajor-3.2.0/cmajor
            </pre>
        </li>
        <li>
            Set library path environment variable.
            It must be inserted to .bashrc to make it permanent.
            <pre>
                export LD_LIBRARY_PATH=/usr/lib:/usr/lib/x86_64-linux-gnu:/usr/local/lib            
            </pre>
        </li>
        <li>
            Change to ~/cmajor-3.2.0/cmajor directory and run make:
            <pre>
                cd ~/cmajor-3.2.0/cmajor
                make
            </pre>
        </li>
        <li>
            Install Cmajor:
            <pre>
                sudo make install
            </pre>
        </li>
        <li>
            Make Cmajor system libraries:
            <pre>
                make sys
            </pre>
        </li>
        <li>
            To ensure that it works we build and run a simple hello world program.
            Change to Hello directory and compile the Hello.cmp and run it:
            <pre>
                cd projects/examples/Hello
                cmc -v Hello.cmp
                slaakko@ACER:~/cmajor-3.2.0/cmajor/projects/examples/Hello$ bin/debug/Hello
                Hello, world!
            </pre>
        </li>
        <li>
            That's all!
        </li>
    </ul>

</body>
</html>
