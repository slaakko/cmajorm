using System;
using System.Collections;
using System.Os;

int main(int argc, const char** argv)
{
    try
    {
        if (argc != 2)
        {
            throw Exception("rec: usage: rec <value>");
        }
        string arg = argv[1];
        int value = ParseInt(arg);
        if (value == 0)
        {
            ushort exitCode = 0u;
            int pid = Fork();
            if (pid == 0)
            {
                Exec("/bin/rec", List<string>(1, string("-1")));
            }
            else
            {
                Wait(&exitCode);
                if (exitCode != 0u)
                {
                    throw Exception("rec: /bin/rec returned " + ToString(exitCode));
                }
                else
                {
                    Console.Out() << "rec: /bin/rec returned normally" << endl();
                }
            }
        }
        else if (value == -1)
        {
            throw Exception("rec: foo");
        }
        else
        {
            throw Exception("rec: invalid value");
        }
    }
    catch (const Exception& ex)
    {
        Console.Error() << ex.ToString() << endl();
        return 1;
    }
    return 0;
}
